# Enterprise-Internal-Private-Cloud-Disk-System（企业内部私有云盘系统）
- 为了学习**线程池**和**epoll多路复用**，基于 Linux 平台，设计了一个类似百度网盘的系统。支持用户注册和登录，每个用户拥有自己**独立**的账号和空间，并可远程连接服务器上传/**下载相关文件**。

- 实现**基本命令交互**功能：

  1. **upload** +client文件夹下的文件名：上传本地文件到服务器

  2. **download** +“目标文件路径”：下载目标文件到本地

  3. **ls** + “路径”：显示路径下所有的文件名

  4. **cp** + “源路径” +  “目标路径”：拷贝文件/文件夹  （实现-r递归功能）

  5. **tree** + “路径”：树形显示路径下所有文件名

  6. **mkdir** + “路径”：创建文件夹

  7. **rm** + “路径”：删除文件或者文件夹  （实现-r递归功能）

  8. **mv** + “源路径” +  “目标路径”:  重命名/移动  （实现-r递归功能）

  9. **pwd** : 显示当前工作目录

  10. **cd** + “路径”：进入路径下的目录

- 实现**用户注册，登录，修改密码**。用 crypt 函数将用户输入的字符加密，然后与密码文件中的密码进行对比了，有一个函数 getspnam 可以根据用户名从/etc/shadow 中得到密码。

- **日志记录**：

  - 服务器日志记录客户端请求信息及客户端连接时间。
  - 服务器日志记录客户端操作记录及操作时间。

- **断点续传**：该功能支持从文件上次中断的地方开始传送数据，而并非是从文件开头传送。举例：进行 gets hello.avi 时候，首先判断本地是否存在 hello.avi

  - 如果存在，则通过 stat 函数获取本地文件 hello.avi 的大小，然后传递给服务器的是gets hello.avi 1000
  - 如果不存在，则直接进行下载即可。

- **大文件传输优化**：mmap 将大文件映射入内存，进行网络传递。当发现文件大于 100M，就使用 mmap 方式映射该文件，然后再传输。

- **用户表设计：**通过关系型数据库 MySQL 存储**用户信息，包括用户名**，**salt** **值**(采用随机字符串生成)，**密码**(密文形式存储)。

  <img src="http://i.endpot.com/image/ANFEZ/%E7%94%A8%E6%88%B7%E8%A1%A8%E8%AE%BE%E8%AE%A1.png" alt="用户表设计.png" style="zoom:50%;" />

- **虚拟文件表**：每个用户只能看到自己上传的文件，而看不到其他用户的文件，这说明每个用户需要拥有自己独立的目录结构。		

  <img src="http://i.endpot.com/image/C4P15/%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E8%A1%A8.png" alt="虚拟文件表.png" style="zoom:50%;" />

- **文件秒传**：如果有两个用户上传的文件都是同一个文件，那需要在服务器端保留两份文件吗？或者说如何实现文件的秒传功能呢？只需要在服务器上查找是否有文件与待上传的文件有相同的MD5 即可。如果相同，则只需要在数据库中添加一条记录，而不需要真的上传文件。

